<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>epage's blog</title>
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha256-3dkvEK0WLHRJ7/Csr0BZjAWxERc5WH7bdeUya2aXxdU= sha512-+L4yy6FRcDGbXJ9mPG8MT/3UCDzwR9gPeyFNMCtInsol++5m3bk2bXWKdZjvybmohrAsn3Ua5x8gfLnbE1YkOg==" crossorigin="anonymous">
<link rel="stylesheet" href="https://unpkg.com/@picocss/pico@latest/css/pico.min.css">
<link rel="stylesheet" href="/style.css" type="text/css" media="all" />
<link rel="alternate" href="/rss.xml" type="application/rss+xml" title="RSS" />

	</head>
	<body>
		<nav class="container-fluid">
			<ul>
				<li><h2>epage's blog</h2></li>
			</ul>
		</nav>
		<main class="container">
			
<article>
	<nav>
		<ul><li>
			<h2><a href="/blog/2022/09/clap4/">clap 4.0, a Rust CLI argument parser</a></h2>
		</li></ul>
		<ul><li>
			<i class="fa fa-calendar"></i> <time pubdate="pubdate">Tue&nbsp;20&nbsp;Sep&nbsp;'22</time>
			
			<br/><i class="fa fa-tags"></i> programming, rust
			
		</li></ul>
	</nav>
	
	<p><p>We are excited to <del>(pre-)</del> announce clap 4.0!
This release focuses on removing deprecated APIs and finishing what we couldn't
do without breaking changes.  For more details see the
<a href="https://github.com/clap-rs/clap/blob/master/CHANGELOG.md">CHANGELOG</a> (including the migration guide)
and the
<a href="https://docs.rs/clap/4.0.0-rc.1/clap/index.html">documentation</a>.</p>
<p>This release builds on done in the 3.x releases and can be worth catching up on them:</p>
<ul>
<li>The <a href="/blog/2022/02/clap-31-a-step-towards-40/">3.1 release</a></li>
<li>The <a href="/blog/2022/06/clap-32-last-call-before-40/">3.2 release</a></li>
<li>Or the <a href="https://github.com/clap-rs/clap/blob/v3-master/CHANGELOG.md">v3 CHANGELOG.md</a> for the over 50 patch releases since 3.0.0</li>
</ul>
<p>To put all of this work into numbers:</p>
<table><thead><tr><th></th><th>Baseline</th><th>2.34.0</th><th>3.0.0</th><th>3.2.21</th><th>4.0.0-rc.1</th><th>4.0.0</th></tr></thead><tbody>
<tr><td>Builder API Surface</td><td></td><td>174</td><td>245</td><td>282</td><td>165 <a href="#removing-deprecated-features">[1]</a> <a href="#num-args">[2]</a></td><td>166</td></tr>
<tr><td>Lines of Code</td><td>6</td><td>13,462</td><td>17,308</td><td>24,044</td><td>20,653 <a href="#removing-deprecated-features">[1]</a> <a href="#removing-lifetimes">[3]</a></td><td>20,839</td></tr>
<tr><td>Code size</td><td>218.2 KiB</td><td>487.0 KiB</td><td>609.3 KiB</td><td>605.5 KiB</td><td>544.3 KiB <a href="#removing-deprecated-features">[1]</a> <a href="#reducing-code-size">[4]</a></td><td>542.6 KiB</td></tr>
<tr><td>Runtime</td><td></td><td>7.529 us</td><td>14.544 us</td><td>14.657 us</td><td>8.2478 us <a href="#removing-implicit-version-help-behavior">[5]</a></td><td>7.6455 us</td></tr>
</tbody></table>
<p><em>(see <a href="#methodology">Methodology</a> for more details)</em></p>
<blockquote>
<p>Aside: Yes, those clap v2 -&gt; v3 numbers are not good.</p>
<p>For Builder API Surface, it is understandable when you consider we mostly didn't
remove functionality in v3 but deprecated it, removing it in v4.</p>
<p>Lines of Code is mostly accounted for with the merge of <code>structopt</code> into
<code>clap</code> as <code>clap_derive</code>.  We continued to have significant growth after
that as we continued to develop replacement features for functionality in
clap.  These more general solutions take up more lines though not more code
size.</p>
<p>For code size and runtime, one factor is that things fell through the cracks
during clap v3's development.  clap's development went dark for an extended
period of time and went through several maintainers.  This isn't to say one
of the maintainers is at fault but that things get lost in hand offs.
Towards the end, we double-downed on just getting out what we had and hadn't
looked to see how we compared to v2.</p>
<p>For code size, it looks like it was a lot of small changes that added up,
like changing a <code>VecMap</code> to a <code>BTreeMap</code>.</p>
<p>For runtime, it seems to mostly be a single feature that caused it which was
removed in v4 <a href="#removing-implicit-version-help-behavior">[5]</a>.</p>
</blockquote>
<p><del>Our plan is to give about a week window between the release-candidate and the
official release to allow for collecting and processing feedback.</del></p>
</p>
	
</article>

<article>
	<nav>
		<ul><li>
			<h2><a href="/blog/2022/06/clap-32-last-call-before-40/">Clap 3.2: Last Call Before 4.0</a></h2>
		</li></ul>
		<ul><li>
			<i class="fa fa-calendar"></i> <time pubdate="pubdate">Mon&nbsp;13&nbsp;Jun&nbsp;'22</time>
			
		</li></ul>
	</nav>
	
	<p><p>With excitement and trepidation, I'm announcing the release of
<a href="https://github.com/clap-rs/clap/blob/master/CHANGELOG.md">clap 3.2</a>.</p>
<p>With clap 3.1, we <a href="https://epage.github.io/blog/2022/02/clap-31-a-step-towards-40/">discussed the need for a more open, extensible
API</a> and clap
3.2 represents one step in that direction.  With two new builder API concepts,
we are able to deprecate the following concepts:</p>
<ul>
<li><code>Arg::allow_invalid_utf8</code></li>
<li><code>Arg::validator</code>, <code>Arg::validator_os</code></li>
<li><code>Arg::forbid_empty_values</code></li>
<li><code>Arg::possible_values</code></li>
<li><code>Arg::max_occurrences</code></li>
<li><code>Arg::multiple_occurrences</code></li>
<li><code>Command::args_override_self</code></li>
<li><code>AppSettings::NoAutoVersion</code></li>
<li><code>AppSettings::NoHelpVersion</code></li>
</ul>
</p>
	
</article>

<article>
	<nav>
		<ul><li>
			<h2><a href="/blog/2022/02/clap-31-a-step-towards-40/">clap 3.1: A step towards 4.0</a></h2>
		</li></ul>
		<ul><li>
			<i class="fa fa-calendar"></i> <time pubdate="pubdate">Wed&nbsp;16&nbsp;Feb&nbsp;'22</time>
			
			<br/><i class="fa fa-tags"></i> programming, rust
			
		</li></ul>
	</nav>
	
	<p><p><a href="https://docs.rs/clap/3.1.0">clap 3.1</a> is here!  Clap is a CLI argument parser
for Rust and the v3.1 releases focuses on API cleanup slated for clap 4.0.  See
the <a href="https://github.com/clap-rs/clap/blob/master/CHANGELOG.md">CHANGELOG</a> for
details.</p>
<p>clap 3.0 was in development for 4 years and though we saw comparisons to
Half-life 3 in response to the release, we also saw people who cited the long
gaps between breaking releases as a motivation for using it.  For clap to stay
relevant we feel we need to avoid the stagnation of long release cycles while
keeping things smooth for the users where clap is already &quot;good enough&quot;.  The
v3.1 release is a major step in trying to strike that balance.</p>
</p>
	
</article>

<article>
	<nav>
		<ul><li>
			<h2><a href="/blog/2022/02/minor-semver-issue/">Minor Semver Issue</a></h2>
		</li></ul>
		<ul><li>
			<i class="fa fa-calendar"></i> <time pubdate="pubdate">Fri&nbsp;04&nbsp;Feb&nbsp;'22</time>
			
			<br/><i class="fa fa-tags"></i> programming, rust
			
		</li></ul>
	</nav>
	
	<p><p>Is adding a function in a patch release a violation of
<a href="https://semver.org/">semver</a>?  Technically, yes but technical answers aren't
always the right answers.</p>
<p>This came up in a recent discussion focused on the
relevant importance of setting the minimum patch version for a dependency.
Some crates go so far as to never bump their minor version, like
<a href="https://crates.io/crates/serde/versions">serde</a>.</p>
</p>
	
</article>

<article>
	<nav>
		<ul><li>
			<h2><a href="/blog/2021/12/clap3/">clap 3.0, a Rust CLI argument parser</a></h2>
		</li></ul>
		<ul><li>
			<i class="fa fa-calendar"></i> <time pubdate="pubdate">Thu&nbsp;30&nbsp;Dec&nbsp;'21</time>
			
			<br/><i class="fa fa-tags"></i> programming, rust
			
		</li></ul>
	</nav>
	
	<p><p>I figured a great way to close out the year 2021 is to wrap up the long awaited
<a href="https://github.com/clap-rs/clap/blob/master/CHANGELOG.md#300-2021-12-31">clap 3.0 release</a>!</p>
<p>Some major milestones along the way:</p>
<ul>
<li>Jan 24, 2018: The <a href="https://github.com/clap-rs/clap/commit/acdbd47152102607b7f4c6702cc076caca771280">first commit in the v3-dev branch</a></li>
<li>Aug 30, 2019: <a href="https://github.com/TeXitoi/structopt/blob/master/CHANGELOG.md#v030-2019-08-30">StructOpt 0.3 is released</a> with better clap integration</li>
<li>May 03, 2021: <a href="https://github.com/clap-rs/clap/releases/tag/v3.0.0-beta.1">v3.0.0-beta.1 is released</a></li>
<li>Dec 08, 2021: <a href="https://github.com/clap-rs/clap/releases/tag/v3.0.0-rc.0">3.0.0-rc.0 is released</a></li>
<li>Dec 31, 2021: <a href="https://github.com/clap-rs/clap/releases/tag/v3.0.0">3.0.0 is released</a></li>
</ul>
<p>Thanks to:</p>
<ul>
<li>kbknapp, pksunkara, dpc, killercup, spacekookie, yosh, ldm0, and any other
maintainers or contributors along the way</li>
<li>Our users, especially those providing feedback on beta and release-candidates</li>
<li>Embark, Sentry, repi, and many other sponsors</li>
<li>My employer, Futurewei, for giving me the opportunity to help wrap up clap 3.0</li>
</ul>
</p>
	
</article>

<article>
	<nav>
		<ul><li>
			<h2><a href="/blog/2021/09/optimizing-toml-edit/">A Journey in Optimizing `toml_edit`</a></h2>
		</li></ul>
		<ul><li>
			<i class="fa fa-calendar"></i> <time pubdate="pubdate">Thu&nbsp;30&nbsp;Sep&nbsp;'21</time>
			
			<br/><i class="fa fa-tags"></i> programming, oss, rust
			
		</li></ul>
	</nav>
	
	<p><h2>tl;dr</h2>
<p><a href="https://docs.rs/toml_edit"><code>toml_edit</code></a> is a format preserving TOML crate,
allowing users to modify <code>.toml</code> files.</p>
<p><strong>Before:</strong></p>
<table><thead><tr><th></th><th><code>cargo init</code> Cargo.toml</th><th>cargo's Cargo.toml</th></tr></thead><tbody>
<tr><td>toml_edit</td><td>8.7us</td><td>271us</td></tr>
<tr><td>toml_edit::easy</td><td>20.7us</td><td>634us</td></tr>
</tbody></table>
<p><strong>After:</strong></p>
<table><thead><tr><th></th><th><code>cargo init</code> Cargo.toml</th><th>cargo's Cargo.toml</th></tr></thead><tbody>
<tr><td>toml_edit</td><td>4.0us</td><td>149us</td></tr>
<tr><td>toml_edit::easy</td><td>5.0us</td><td>179us</td></tr>
</tbody></table>
<p><strong>Target:</strong></p>
<table><thead><tr><th></th><th><code>cargo init</code> Cargo.toml</th><th>cargo's Cargo.toml</th></tr></thead><tbody>
<tr><td>toml-rs</td><td>4.7us</td><td>121us</td></tr>
</tbody></table>
</p>
	
</article>

<article>
	<nav>
		<ul><li>
			<h2><a href="/blog/2021/09/learning-rust/">Learnability of Rust</a></h2>
		</li></ul>
		<ul><li>
			<i class="fa fa-calendar"></i> <time pubdate="pubdate">Wed&nbsp;15&nbsp;Sep&nbsp;'21</time>
			
			<br/><i class="fa fa-tags"></i> programming, oss, rust
			
		</li></ul>
	</nav>
	
	<p><h2>tl;dr</h2>
<p>As part of improving the learnability of Rust, I propose:</p>
<ul>
<li>The <code>.crs</code> file subset of <a href="https://github.com/DanielKeep/cargo-script">cargo-script</a> be brought into <code>cargo</code></li>
<li>We support converting <code>.crs</code> to full cargo projects with <code>cargo init --from &lt;script&gt;.crs</code></li>
<li>We collaborate on an ergonomics-focused standard-library-alternative, like <a href="https://docs.rs/eztd">eztd</a></li>
</ul>
</p>
	
</article>

<article>
	<nav>
		<ul><li>
			<h2><a href="/blog/2021/07/pushgen-experiment/">Experiments with `pushgen`</a></h2>
		</li></ul>
		<ul><li>
			<i class="fa fa-calendar"></i> <time pubdate="pubdate">Wed&nbsp;07&nbsp;Jul&nbsp;'21</time>
			
			<br/><i class="fa fa-tags"></i> programming, rust
			
		</li></ul>
	</nav>
	
	<p><p>Recently, there was an <a href="https://www.reddit.com/r/rust/comments/oa6tcp/first_crate_pushgen_pushbased_approach_to/">announcement for
<code>pushgen</code></a>,
a port of C++ <code>transrangers</code> to Rust with a <a href="https://github.com/joaquintides/transrangers/blob/master/rust.md">follow up
post</a> from
the author of <code>transrangers</code>.</p>
<p>Seeing the performance numbers, I was curious what the experience was like with
the different techniques compared in the followup and how the performance
worked out in a real world application.</p>
</p>
	
</article>

<article>
	<nav>
		<ul><li>
			<h2><a href="/blog/2020/03/liquid-v20/">Liquid v0.20</a></h2>
		</li></ul>
		<ul><li>
			<i class="fa fa-calendar"></i> <time pubdate="pubdate">Mon&nbsp;16&nbsp;Mar&nbsp;'20</time>
			
			<br/><i class="fa fa-tags"></i> programming, oss
			
		</li></ul>
	</nav>
	
	<p><p><code>liquid</code> v0.20 resolves several planned breaking changes we've been holding off on.  This doesn't make us ready for 1.0 yet but this closes the gap significantly.</p>
<p><em><a href="https://docs.rs/liquid"><code>liquid-rust</code></a> is a rust re-implementation of the <a href="https://shopify.github.io/liquid/">liquid</a> template engine made popular by the <a href="https://jekyllrb.com">jekyll</a> static site generator.</em></p>
</p>
	
</article>

<article>
	<nav>
		<ul><li>
			<h2><a href="/blog/2019/11/reflecting-on-errors-in-2019/">Reflecting on Errors in 2019</a></h2>
		</li></ul>
		<ul><li>
			<i class="fa fa-calendar"></i> <time pubdate="pubdate">Tue&nbsp;26&nbsp;Nov&nbsp;'19</time>
			
		</li></ul>
	</nav>
	
	<p><p>With people reflecting on Rust in 2019 and what they want to see in 2020, error handling has come up again:</p>
<ul>
<li><a href="https://www.ncameron.org/blog/rust-in-2020-one-more-thing/">Rust in 2020, one more thing</a></li>
<li><a href="https://lukaskalbertodt.github.io/2019/11/14/thoughts-on-error-handling-in-rust.html">Thoughts on Error Handling in Rust</a></li>
<li><a href="https://blog.yoshuawuyts.com/error-handling-survey/">Error Handling Survey</a></li>
</ul>
</p>
	
</article>

<article>
	<nav>
		<ul><li>
			<h2><a href="/blog/2019/10/speeding-up-rust-builds-code-gen-edition/">Speeding Up Rust Builds: Code-Gen Edition</a></h2>
		</li></ul>
		<ul><li>
			<i class="fa fa-calendar"></i> <time pubdate="pubdate">Thu&nbsp;10&nbsp;Oct&nbsp;'19</time>
			
			<br/><i class="fa fa-tags"></i> programming, rust
			
		</li></ul>
	</nav>
	
	<p><p><em>tl;dr Cache your code-gen results with the <a href="https://crates.io/crates/codegenrs"><code>codegenrs</code> crate</a>.</em></p>
</p>
	
</article>

<article>
	<nav>
		<ul><li>
			<h2><a href="/blog/2018/06/rustfest-2018/">RustFest Parist Trip Report</a></h2>
		</li></ul>
		<ul><li>
			<i class="fa fa-calendar"></i> <time pubdate="pubdate">Mon&nbsp;04&nbsp;Jun&nbsp;'18</time>
			
			<br/><i class="fa fa-tags"></i> programming, rust
			
		</li></ul>
	</nav>
	
	<p><p>I've been involved in the Rust community for about a year and a half now.  What
attracted me to Rust is that is looks like the first viable replacement for
C++.  It offers similar (actually better) protections than GCed languages and
the full language is available in any environment, including exception-like
error handling in the Windows kernel.</p>
</p>
	
</article>

<article>
	<nav>
		<ul><li>
			<h2><a href="/blog/2018/05/pycon-2018/">PyCon 2018 Trip Report</a></h2>
		</li></ul>
		<ul><li>
			<i class="fa fa-calendar"></i> <time pubdate="pubdate">Fri&nbsp;18&nbsp;May&nbsp;'18</time>
			
			<br/><i class="fa fa-tags"></i> programming, python
			
		</li></ul>
	</nav>
	
	<p><p>I went to with a coworker to <a href="https://us.pycon.org/2018/">PyCon</a> this year (<a href="https://www.youtube.com/channel/UCsX05-2sVSH7Nx3zuk3NYuQ/videos">videos</a>).</p>
</p>
	
</article>

<article>
	<nav>
		<ul><li>
			<h2><a href="/blog/2018/03/redefining-failure/">Redefining Failure</a></h2>
		</li></ul>
		<ul><li>
			<i class="fa fa-calendar"></i> <time pubdate="pubdate">Fri&nbsp;09&nbsp;Mar&nbsp;'18</time>
			
			<br/><i class="fa fa-tags"></i> programming, rust
			
		</li></ul>
	</nav>
	
	<p><p>I recently got the chance to redo the error handling in two different crates I
help maintain. For <a href="https://github.com/cobalt-org/liquid-rust"><code>liquid</code></a>, I decided to write the error types by
hand rather than use something like <a href="https://crates.io/crates/error-chain"><code>error-chain</code></a>. In the case
of <a href="https://github.com/assert-rs/assert_cli"><code>assert_cli</code></a>, I decided to finally give <a href="https://github.com/withoutboats/failure"><code>failure</code></a> a
try.</p>
</p>
	
</article>

<article>
	<nav>
		<ul><li>
			<h2><a href="/blog/2018/01/crate-management/">Crate Management for #rust2018</a></h2>
		</li></ul>
		<ul><li>
			<i class="fa fa-calendar"></i> <time pubdate="pubdate">Fri&nbsp;26&nbsp;Jan&nbsp;'18</time>
			
			<br/><i class="fa fa-tags"></i> programming, rust
			
		</li></ul>
	</nav>
	
	<p><p><em>Context: <a href="https://blog.rust-lang.org/2018/01/03/new-years-rust-a-call-for-community-blogposts.html">Call for Community Posts</a> and <a href="http://readrust.net/rust2018/">other posts</a></em></p>
</p>
	
</article>

<article>
	<nav>
		<ul><li>
			<h2><a href="/blog/2018/01/blog-transition/">Blog Transition</a></h2>
		</li></ul>
		<ul><li>
			<i class="fa fa-calendar"></i> <time pubdate="pubdate">Wed&nbsp;17&nbsp;Jan&nbsp;'18</time>
			
		</li></ul>
	</nav>
	
	<p><p>I'll post relevant items from my old blog.  If you'd like to see all the old posts, go to <a href="eopage.blogspot.com">eopage.blogspot.com</a></p>
</p>
	
</article>

<article>
	<nav>
		<ul><li>
			<h2><a href="/blog/2017/01/shaky-start/">Off To A Shaky Start - LASIK and Nystagmus</a></h2>
		</li></ul>
		<ul><li>
			<i class="fa fa-calendar"></i> <time pubdate="pubdate">Mon&nbsp;30&nbsp;Jan&nbsp;'17</time>
			
			<br/><i class="fa fa-tags"></i> personal
			
		</li></ul>
	</nav>
	
	<p>My personal experience treating nystagmus
</p>
	
</article>

<article>
	<nav>
		<ul><li>
			<h2><a href="/blog/2014/12/lone-star-hiking/">The Lone Star Hiking Trail</a></h2>
		</li></ul>
		<ul><li>
			<i class="fa fa-calendar"></i> <time pubdate="pubdate">Wed&nbsp;03&nbsp;Dec&nbsp;'14</time>
			
			<br/><i class="fa fa-tags"></i> hiking
			
		</li></ul>
	</nav>
	
	<p>Trip/equipment report for the Long Star Hiking Trail
</p>
	
</article>

<article>
	<nav>
		<ul><li>
			<h2><a href="/blog/2013/08/kings-peak/">On Top of Utah - Hiking to Kings Peak</a></h2>
		</li></ul>
		<ul><li>
			<i class="fa fa-calendar"></i> <time pubdate="pubdate">Sat&nbsp;17&nbsp;Aug&nbsp;'13</time>
			
			<br/><i class="fa fa-tags"></i> hiking
			
		</li></ul>
	</nav>
	
	<p>Trip/equipment report for Kings Peak in Utah
</p>
	
</article>


		</main>
			<nav>
		<ul>
			<li><a href="https://epage.github.io/about"><img class="footer-about" src="https://epage.github.io/img/me.jpg" alt="Headshot"/></a></li>
			<li>
				<a href="https://epage.github.io/rss.xml"><i class="fa fa-rss-square"></i> feed</a>
				<a href="https://github.com/epage"><i class="fa fa-github-square"></i> github</a>
				<a href="https://www.linkedin.com/in/eopage"><i class="fa fa-linkedin-square"></i> linkedin</a>
			</li>
		</ul>
		<ul>
			<li>
				<a href="https://epage.github.io/license">CC BY-SA 4.0 / MIT</a><br/>
			</li>
		</ul>
	</nav>

	</body>
</html>
